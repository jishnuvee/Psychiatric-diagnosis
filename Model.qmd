---
title: "Model"
format: html
execute: 
  echo: false
---

# EEG Multinomial Regression with Individual Delta Power



---
title: "Model"
format: html
execute: 
  echo: false
---



# EEG Multinomial Regression with Individual Delta Power

The following equation represents the multinomial logistic regression model used to predict psychiatric disorders from demographic and EEG delta power variables:

$$
\begin{align*}
\log\left( \frac{P(\texttt{specific.disorder} = k)}{P(\texttt{specific.disorder} = \text{baseline})} \right) =\ 
& \beta_{0,k} + \beta_{1,k} \cdot \texttt{education} + \beta_{2,k} \cdot \texttt{age} + \beta_{3,k} \cdot \texttt{sex} + \beta_{4,k} \cdot \texttt{IQ} \\
& + \beta_{5,k} \cdot \texttt{AB.A.delta.a.FP1} + \beta_{6,k} \cdot \texttt{AB.A.delta.b.FP2} \\
& + \beta_{7,k} \cdot \texttt{AB.A.delta.c.F7} + \beta_{8,k} \cdot \texttt{AB.A.delta.d.F3} \\
& + \beta_{9,k} \cdot \texttt{AB.A.delta.e.Fz} + \beta_{10,k} \cdot \texttt{AB.A.delta.f.F4} \\
& + \beta_{11,k} \cdot \texttt{AB.A.delta.g.F8}
\end{align*}
$$

```{r}
#| warning: false
#| message: false

# Load required packages
suppressPackageStartupMessages({
  library(tidyverse)
  library(tidymodels)
  library(yardstick)
  library(nnet)  # For multinom function
  library(car)   # For VIF calculation
})

# Set random seed for reproducibility
set.seed(123)

# Load the real dataset
df <- read_csv("EEG.machinelearing_data_BRMH.csv")

# Preprocess the data
df <- df %>%
  mutate(
    sex = as.factor(sex),
    specific.disorder = as.factor(specific.disorder)
  ) %>%
  mutate(
    specific.disorder = relevel(specific.disorder, ref = "Healthy control")
  ) %>%
  filter(complete.cases(education, age, sex, IQ, 
                        AB.A.delta.a.FP1, AB.A.delta.b.FP2, AB.A.delta.c.F7, 
                        AB.A.delta.d.F3, AB.A.delta.e.Fz, AB.A.delta.f.F4, 
                        AB.A.delta.g.F8, specific.disorder))

# Check for collinearity using Variance Inflation Factor (VIF)
vif_model <- multinom(specific.disorder ~ education + age + sex + IQ + 
                      AB.A.delta.a.FP1 + AB.A.delta.b.FP2 + AB.A.delta.c.F7 + 
                      AB.A.delta.d.F3 + AB.A.delta.e.Fz + AB.A.delta.f.F4 + 
                      AB.A.delta.g.F8, data = df, maxit = 1000)
vif_values <- vif(vif_model)

# Fit multinomial logistic regression model
fit_disorder <- multinom_reg(mode = "classification") %>%
  set_engine("nnet", maxit = 1000) %>%
  fit(specific.disorder ~ education + age + sex + IQ + 
        AB.A.delta.a.FP1 + AB.A.delta.b.FP2 + AB.A.delta.c.F7 + 
        AB.A.delta.d.F3 + AB.A.delta.e.Fz + AB.A.delta.f.F4 + 
        AB.A.delta.g.F8, data = df)

# Extract model coefficients with confidence intervals
model_results <- tidy(fit_disorder, conf.int = TRUE)

# Display model results
model_results %>%
  select(term, y.level, estimate, std.error, conf.low, conf.high) %>%
  knitr::kable(digits = 3, caption = "Model Coefficients and Confidence Intervals")

```


